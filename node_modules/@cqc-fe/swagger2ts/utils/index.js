// 判断一个文件是否存在
const fs = require('fs');
const path = require('path');
const fsExistsSync = (path) => {
    return fs.existsSync(path)
}

// 输出错误信息
const throwNewError = (err) => {
    throw new Error(err)
}

/**
 * 移动文件
 * @param {*} sourceFileDir 源文件夹
 * @param {*} sourceFileNameArr 源文件夹需要移动的文件名
 * @param {*} destDir 目标文件夹
 */
const batchMoveFile = (sourceFileDir, sourceFileNameArr, destDir) => {
    sourceFileNameArr.forEach(fileName => {
        const sourceFile = `${sourceFileDir}/${fileName}`
        const destPath = `${destDir}/${fileName}`
        fs.rename(sourceFile, destPath, function (err) {
            if (err) throw err;
            fs.stat(destPath, function (err, stats) {
                if (err) throw err;
            });
        });
    })
}

/**
 * 删除某一个路径下的文件。
 * @param  {String} url  文件路径，绝对路径
 * @param  {Array} nameArr 需要删除的文件名称
 */
function batchDeleteFile(url, nameArr) {
    var files = [];
    if (fs.existsSync(url)) {    //判断给定的路径是否存在
        files = fs.readdirSync(url);    //返回文件和子目录的数组
        files.forEach(function (file) {
            var curPath = path.join(url, file);

            if (!fs.statSync(curPath).isDirectory()) {
                nameArr.forEach(name => {
                    if (file.indexOf(name) > -1) {
                        fs.unlinkSync(curPath);
                    }
                })
            }
        });
    } else {
        throwNewError("给定的路径不存在！")
    }

}


module.exports = {
    fsExistsSync,
    throwNewError,
    batchMoveFile,
    batchDeleteFile
}